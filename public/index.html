<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Clear-Site-Data" content="*">
    <title>Vision Board</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.7.1/svg.min.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-left">
                <button id="sidebar-toggle" class="sidebar-toggle"><i class="fas fa-bars"></i></button>
                <h1>Vision Board</h1>
                <nav class="breadcrumb" id="breadcrumb">
                    <span class="breadcrumb-item active">Main Canvas</span>
                </nav>
            </div>
            <div class="toolbar">
                <input type="file" id="file-input" accept="image/*" multiple style="display: none;">
                <button id="upload-btn" title="Add Images"><i class="far fa-images"></i></button>
                <button id="new-folder-btn" title="New Folder"><i class="far fa-folder"></i></button>
                <button id="new-canvas-btn" title="New Canvas"><i class="far fa-square-plus"></i></button>
                <div class="toolbar-separator"></div>

                <!-- Drawing Tools Section -->
                <div class="drawing-tools">
                    <button id="tool-hand" class="tool-button active" title="Hand Tool (H)" data-tool="hand">
                        <i class="far fa-hand"></i>
                    </button>
                    <button id="tool-rectangle" class="tool-button" title="Rectangle Tool (R)" data-tool="rectangle">
                        <i class="far fa-square"></i>
                    </button>
                    <button id="tool-line" class="tool-button" title="Line Tool (L)" data-tool="line">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button id="tool-freehand" class="tool-button" title="Freehand Tool (F)" data-tool="freehand">
                        <i class="far fa-pen-to-square"></i>
                    </button>
                </div>
                <div class="toolbar-separator"></div>

                <!-- Color Palette Section -->
                <div class="color-palette">
                    <div id="current-color" class="current-color" title="Current Color"></div>
                    <div class="color-swatches">
                        <div id="color-swatch-0" class="color-swatch" title="Color 1"></div>
                        <div id="color-swatch-1" class="color-swatch" title="Color 2"></div>
                        <div id="color-swatch-2" class="color-swatch" title="Color 3"></div>
                        <div id="color-swatch-3" class="color-swatch" title="Color 4"></div>
                    </div>
                </div>
                <div class="toolbar-separator"></div>

                <button id="undo-btn" title="Undo (Ctrl+Z)" disabled><i class="fas fa-rotate-left"></i></button>
                <button id="redo-btn" title="Redo (Ctrl+Shift+Z)" disabled><i class="fas fa-rotate-right"></i></button>
                <div class="toolbar-separator"></div>
                <button id="save-btn" title="Save"><i class="far fa-floppy-disk"></i></button>
                <div class="toolbar-separator"></div>
                <button id="export-png-btn" title="Export PNG"><i class="far fa-image"></i></button>
                <button id="export-json-btn" title="Export JSON"><i class="far fa-file-code"></i></button>
                <button id="import-json-btn" title="Import JSON"><i class="fas fa-file-import"></i></button>
                <div class="toolbar-separator"></div>
                <button id="grid-btn" title="Toggle Grid (G)"><i class="fas fa-border-all"></i></button>
                <button id="snap-btn" title="Toggle Snap (S)"><i class="fas fa-magnet"></i></button>
                <button id="layers-btn" title="Toggle Layers Panel (Shift+L)"><i class="fas fa-layer-group"></i></button>
                <div class="toolbar-separator"></div>
                <button id="help-btn" title="Keyboard Shortcuts (?)"><i class="far fa-keyboard"></i></button>
            </div>
        </header>
        
        <div class="app-body">
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3>Canvas Navigator</h3>
                    <button id="sidebar-new-canvas-btn" class="sidebar-new-canvas" title="Create new canvas"><i class="fas fa-plus"></i></button>
                    <button id="sidebar-close" class="sidebar-close"><i class="fas fa-times"></i></button>
                </div>
                <div class="tree-container">
                    <div id="canvas-tree" class="canvas-tree">
                        <!-- Tree will be populated by JavaScript -->
                    </div>
                </div>
            </aside>
            
            <main class="main-content">
                <div class="canvas-container">
                    <div id="canvas" class="canvas"></div>
                    <div id="drop-zone" class="drop-zone">
                        <p>Drop images here or click "Add Images" to upload</p>
                    </div>
                </div>
            </main>

            <!-- Layers Panel (right side) -->
            <aside class="layers-panel" id="layers-panel">
                <div class="layers-panel-header">
                    <h3>Layers</h3>
                    <button id="layers-panel-close" class="layers-panel-close"><i class="fas fa-times"></i></button>
                </div>
                <div class="layers-list-container">
                    <div id="layers-list" class="layers-list">
                        <!-- Layers will be populated by JavaScript -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Autosave notification -->
    <div id="autosave-notification" class="autosave-notification"></div>

    <!-- Color Picker Modal -->
    <div id="color-picker-modal" class="color-picker-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Choose Color</h3>
                <button id="modal-close" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <input type="color" id="color-picker-input" class="color-picker-input" value="#000000">
                <div class="color-preview">
                    <div class="color-preview-current" id="color-preview-current"></div>
                    <div class="color-preview-new" id="color-preview-new"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="modal-cancel" class="modal-button modal-cancel">Cancel</button>
                <button id="modal-ok" class="modal-button modal-ok">OK</button>
            </div>
        </div>
    </div>

    <!-- Console logger must be first to capture all logs -->
    <script src="js/console-logger.js"></script>
    <script src="js/toolbar-scale.js"></script>
    <script src="js/config.js"></script>
    <script src="js/api-adapter.js"></script>
    <script src="js/selection.js"></script>
    <script src="js/color-manager.js"></script>
    <script src="js/drawing-tools.js"></script>
    <script src="js/canvas-resize.js"></script>
    <script src="js/image-filters.js"></script>
    <script src="js/transform.js"></script>
    <script src="js/canvas-elements.js"></script>
    <script src="js/canvas-core.js"></script>
    <script src="js/undo-redo.js"></script>
    <script src="js/keyboard-help.js"></script>
    <script src="js/clipboard.js"></script>
    <script src="js/z-order.js"></script>
    <script src="js/zoom-controls.js"></script>
    <script src="js/keyboard-shortcuts.js"></script>
    <script src="js/grid-snap.js"></script>
    <script src="js/drag-drop.js"></script>
    <script src="js/tauri-file-drop.js"></script>
    <script src="js/tree-nav.js"></script>
    <script src="js/touch.js"></script>
    <script src="js/export.js"></script>
    <script src="js/grouping.js"></script>
    <script src="js/alignment.js"></script>
    <script src="js/layers-panel.js"></script>
    <script src="js/context-menu.js"></script>
    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.canvasCore.initializeCanvas();
            initializeDragDrop();
            initializeTreeNav(); // This calls loadTreeData() which loads the canvas
            initializeExport();
            // Note: loadCanvas is called by initializeTreeNav() -> loadTreeData()

            // Connect tool manager to canvas after canvas is initialized
            if (window.toolManager && window.canvas) {
                window.toolManager.setCanvas(window.canvas);
            }
        });
    </script>
</body>
</html>